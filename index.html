<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ComfortLink</title>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  background: #f4f6f8;
}
header {
  background: #2f6df6;
  color: white;
  padding: 16px;
  text-align: center;
  font-size: 20px;
  font-weight: bold;
}
.container {
  padding: 16px;
}
.machine {
  background: white;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-top: 6px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}
.start { background: #2f6df6; color: white; }
.request { background: #ef4444; color: white; }
.done { background: #22c55e; color: white; }
input {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  font-size: 16px;
}
.status {
  font-weight: bold;
  margin: 8px 0;
}
</style>
</head>

<body>

<header>
ComfortLink  
<br><small>ë¶ˆí¸í•¨ì„ ì—°ê²°ë¡œ í•´ê²°í•˜ë‹¤</small>
</header>

<div class="container">

<div class="machine">
  <h2>ğŸ§º ì„¸íƒê¸°</h2>
  <div class="status" id="washerStatus">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="washerTime"></div>

  <input id="washerRoom" placeholder="ë°© ë²ˆí˜¸ (ì˜ˆ: 203í˜¸)">
  <input id="washerMin" placeholder="ì‚¬ìš© ì‹œê°„ (ë¶„)">
  <button class="start" onclick="start('washer')">ì‚¬ìš© ì‹œì‘</button>
  <button class="request" onclick="requestClean('washer')">ì •ë¦¬ ìš”ì²­</button>
  <button class="done" onclick="finish('washer')">ì •ë¦¬ ì™„ë£Œ</button>
</div>

<div class="machine">
  <h2>ğŸ”¥ ê±´ì¡°ê¸°</h2>
  <div class="status" id="dryerStatus">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="dryerTime"></div>

  <input id="dryerRoom" placeholder="ë°© ë²ˆí˜¸ (ì˜ˆ: 203í˜¸)">
  <input id="dryerMin" placeholder="ì‚¬ìš© ì‹œê°„ (ë¶„)">
  <button class="start" onclick="start('dryer')">ì‚¬ìš© ì‹œì‘</button>
  <button class="request" onclick="requestClean('dryer')">ì •ë¦¬ ìš”ì²­</button>
  <button class="done" onclick="finish('dryer')">ì •ë¦¬ ì™„ë£Œ</button>
</div>

</div>

<!-- ğŸ”¥ Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyALbv48xEDyGtdaNn8MCvF79bqDmEKjjf0",
  authDomain: "comfortlink-laundry.firebaseapp.com",
  projectId: "comfortlink-laundry",
  storageBucket: "comfortlink-laundry.firebasestorage.app",
  messagingSenderId: "484193931044",
  appId: "1:484193931044:web:fb528955ca8088950c6db1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const washerRef = doc(db, "machines", "washer");
const dryerRef = doc(db, "machines", "dryer");

async function init() {
  await setDoc(washerRef, { status: "idle" }, { merge: true });
  await setDoc(dryerRef, { status: "idle" }, { merge: true });
}
init();

onSnapshot(washerRef, snap => render("washer", snap.data()));
onSnapshot(dryerRef, snap => render("dryer", snap.data()));

window.start = async (type) => {
  const room = document.getElementById(type+"Room").value;
  const min = parseInt(document.getElementById(type+"Min").value);
  if (!room || !min) return alert("ì…ë ¥í•˜ì„¸ìš”");

  const ref = type === "washer" ? washerRef : dryerRef;
  await updateDoc(ref, {
    status: "using",
    room,
    end: Date.now() + min * 60000
  });
};

window.requestClean = async (type) => {
  const ref = type === "washer" ? washerRef : dryerRef;
  await updateDoc(ref, { status: "request" });
};

window.finish = async (type) => {
  const ref = type === "washer" ? washerRef : dryerRef;
  await updateDoc(ref, { status: "idle", room: "", end: null });
};

function render(type, data) {
  if (!data) return;
  const statusEl = document.getElementById(type+"Status");
  const timeEl = document.getElementById(type+"Time");

  if (data.status === "idle") {
    statusEl.innerText = "ì‚¬ìš© ê°€ëŠ¥";
    timeEl.innerText = "";
  }

  if (data.status === "using") {
    statusEl.innerText = `${data.room} ì‚¬ìš© ì¤‘`;
    const left = Math.max(0, Math.floor((data.end - Date.now())/60000));
    timeEl.innerText = `ë‚¨ì€ ì‹œê°„: ${left}ë¶„`;
  }

  if (data.status === "request") {
    statusEl.innerText = "âš ï¸ ì •ë¦¬ ìš”ì²­ë¨";
  }
}

setInterval(() => {
  render("washer", null);
  render("dryer", null);
}, 1000);
</script>

</body>
</html> 